<div layout="row" layout-margin layout="column" data-ng-controller="CreateCtrl" bind-embedly ng-cloak class="create">
    <div flex>
        <md-card>
            <md-toolbar>
                <div class="md-toolbar-tools">
                    <h2>Create a non-profit campaign</h2>
                </div>
            </md-toolbar>
            <md-stepper-card-content class="md-no-padding">
                <md-steppers md-dynamic-height md-stretch-steppers="always" md-selected="vm.selectedStep" md-busy-text="'Fetching data & other things...'" md-busy="vm.showBusyText">
                    <md-step label="Enter Url" md-complete="vm.stepData[0].completed" ng-disabled="vm.stepProgress < 1">
                        <md-step-body>
                            <div layout="column">
                                <div layout="row" layout-padding layout-align="center start">
                                    <div flex="60" flex-sm="90" flex-xs="100">
                                        <span class="md-title">
                                            Paste any non-profit url
                                        </span>
                                        <form name="step1" ng-submit="vm.getUrlInfo(vm.stepData[0].data.product_url)">
                                            <div layout="row" layout-xs="column" flex>
                                                <md-input-container flex class="md-block">
                                                    <input name="product_url" ng-model="vm.stepData[0].data.product_url" ng-disabled="vm.showBusyText" md-select-on-focus ng-pattern="vm.urlPattern" ng-model-options="{ updateOn: 'default blur', debounce: { default: 300, blur: 300 } }" required aria-label="Enter Url"/>
                                                    <div class="hint" ng-show="vm.showProductUrlHint">{{vm.productUrlHint}}</div>
                                                    <div ng-messages="step1.product_url.$error" role="alert">
                                                        <div ng-message-exp="['required','pattern']">
                                                            That doesn't look like a valid url... are you sure you pasted the right thing?
                                                        </div>
                                                    </div>
                                                </md-input-container>
                                                <div>
                                                    <md-button type="submit" class="md-raised" ng-disabled="!vm.stepData[0].data.product_url || loading_embedly || vm.showBusyText" aria-label="Get URL Info"  ng-click="vm.getUrlInfo(vm.stepData[0].data.product_url)">
                                                        <md-icon class="material-icons">search</md-icon>
                                                        Find Cause
                                                    </md-button>
                                                </div>
                                            </div>
                                        </form>
                                        <md-progress-linear md-mode="indeterminate" ng-show="loading_embedly"></md-progress-linear>
                                        <div ng-show="showPreview">
                                            <embedly urlsearch="{{vm.urlSearch}}" onempty="tryAgain()"></embedly>
                                            <md-toolbar class="md-accent">
                                                <div class="md-toolbar-tools">
                                                    <md-icon class="material-icons" hide-xs style="margin-right:10px">arrow_upward</md-icon>
                                                    <h2>Does this look right?</h2>
                                                    <span flex></span>
                                                    <md-button hide-xs class="md-accent md-hue-3 md-mini" ng-disabled="vm.showBusyText || loading_embedly || !showPreview" ng-click="vm.showUrlEducationDialog($event)" aria-label="No, but why?">
                                                        No
                                                    </md-button>
                                                    <md-button class="md-primary md-raised" ng-disabled="vm.showBusyText || loading_embedly || !showPreview" ng-click="vm.submitCurrentStep(vm.stepData[0])" aria-label="Yep, let's move on!">
                                                        Yes<span hide-xs>, let's move on!</span>
                                                    </md-button>
                                                </div>
                                            </md-toolbar>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </md-step-body>
                    </md-step>
                    <md-step label="Customize" md-complete="vm.stepData[1].completed" ng-disabled="vm.stepProgress < 2">
                        <md-step-body>
                            <div layout="column" layout-gt-sm="row" layout-align="center start">
                                <div flex="100" flex-gt-sm="50" flex-order="1" flex-order-gt-sm="0" layout-padding>
                                    <embedly urlsearch="{{vm.urlSearch}}"></embedly>
                                    <md-toolbar class="md-accent">
                                        <div class="md-toolbar-tools">
                                            <md-icon class="material-icons" hide-xs style="margin-right:10px">arrow_upward</md-icon>
                                            <h2>Is this correct?</h2>
                                            <span flex></span>
                                            <md-button hide-xs class="md-accent md-hue-3 md-mini" ng-disabled="vm.showBusyText" ng-click="vm.moveToPreviousStep()" aria-label="Go back">
                                                No, go back
                                            </md-button>
                                            <md-button class="md-primary md-raised" ng-disabled="vm.showBusyText || !vm.stepData[1].data.title || !vm.stepData[1].data.price" ng-click="vm.submitCurrentStep(vm.stepData[1])" aria-label="Yep, let's move on!">
                                                Yes<span hide-xs>, create campaign link!</span>
                                            </md-button>
                                        </div>
                                    </md-toolbar>
                                </div>
                                <div flex="100" flex-gt-sm="50" flex-order="0" flex-order-gt-sm="1" layout-padding layout-margin>
                                    <span class="md-title">Customize your cause.</span>
                                    <form name="step2">
                                        <md-input-container class="md-icon-float md-block">
                                            <label>Title of cause</label>
                                            <md-icon class="material-icons">font_download</md-icon>
                                            <input name="title" class="cause-title" required ng-model="cardTitle" aria-label="Title of cause" />
                                            <div ng-messages="step2.title.$error" role="alert">
                                                <div ng-message-exp="['required']">
                                                    Please add a title to your cause so we know what to call it.
                                                </div>
                                            </div>
                                        </md-input-container>
                                        <md-input-container class="md-icon-float md-block">
                                            <label>Total Donation Amount</label>
                                            <md-icon class="material-icons">attach_money</md-icon>
                                            <input name="price" type="number" ng-model="vm.stepData[1].data.price" required aria-label="Total donation amount" />
                                            <div class="hint">Taxes will be added to physical products during campaign creation. Shipping is free.</div>
                                            <div ng-messages="step2.price.$error" role="alert">
                                                <div ng-message-exp="['required']">
                                                    Please add a donation price for your cause so we know how much to help you raise.
                                                </div>
                                            </div>
                                        </md-input-container>
                                        <md-content>
                                        <p>Choose campaign image</p>
                                        <hr/>
                                        <div layout="row" layout-xs="column" layout-align="start start" layout-wrap>
                                            <md-card flex="20" ng-repeat="image in ::embedlyImages track by $index">
                                                <img class="embedly-variation-images" ng-class="{'selected': mdCardImg.src === image.url}" style="cursor: pointer;" ng-src="{{ image.url }}" alt="{{ image.caption}}" />
                                            </md-card>
                                        </div>
                                        </md-content>
                                        <p>Upload custom campaign image <em>(optional)</em></p>
                                        <md-content class="filestack-container" layout-padding>
                                            <input id="filestack-widget" filepicker data-fp-apikey="AVdh2bvkuTYKQI3rdMsZXz" type="filepicker-dragdrop" data-fp-services="computer,url,webcam,video,gmail,facebook,instagram,twitter,box,dropbox,googledrive" on-success="setUploadedImage(event.fpfile)" />
                                        </md-content>
                                        <md-input-container class="md-block">
                                              <label>Or paste image URL </label>
                                              <input name="imageurl" class="cause-img" ng-model="cardImg" />
                                        </md-input-container>
                                    </form>
                                    <div flex>
                                        <md-toolbar class="md-accent" ng-show="!loading_embedly">
                                            <div class="md-toolbar-tools">
                                                <h2 style="margin-left:10px">
                                                  <span>All set?</span>
                                                </h2>
                                                <span flex></span>
                                                <md-button class="md-primary md-raised" ng-disabled="vm.showBusyText" ng-click="vm.submitCurrentStep(vm.stepData[1], true)" aria-label="Perfect, let's finish!">
                                                  Perfect, let's finish!
                                                </md-button>
                                                <md-button class="md-accent md-hue-2 md-fab md-mini" ng-disabled="vm.showBusyText" ng-click="showUrlEducationDialog($event)" aria-label="No, but why?">
                                                  No
                                                </md-button>
                                              </div>
                                        </md-toolbar>
                                    </div>
                                </div>
                            </div>
                        </md-step-body>
                    </md-step>
                    <md-step label="Finish" md-complete="vm.stepData[2].completed" ng-disabled="vm.stepProgress < 3">
                        <md-step-body>
                            <div layout="row" layout-padding layout-align="center start">
                                <div flex="50" flex-sm="90" flex-xs="100">
                                    <span class="md-title">Copy/paste the link below into a new tab</span>
                                    <div layout="row" layout-xs="column" flex>
                                        <md-input-container flex class="md-block">
                                            <input id="shortLink" ng-model="vm.campaignCreateShortLink" md-select-on-focus ng-readonly="true" aria-label="Campaign Short Link" />
                                        </md-input-container>
                                        <div>
                                            <md-button ng-show="!vm.showClipboardTooltip && !vm.showFallbackClipboardTooltip" type="button" class="md-raised" aria-label="Copy URL" ngclipboard data-clipboard-target="#shortLink" ngclipboard-success="vm.clipboardCopySuccess($event);" ngclipboard-error="vm.clipboardCopyError($event);">
                                                <md-icon class="material-icons">content_copy</md-icon>
                                                Copy Url
                                            </md-button>
                                            <md-button ng-show="vm.showClipboardTooltip || vm.showFallbackClipboardTooltip" type="button" class="md-raised md-accent md-hue-3" aria-label="URL Copied!" ngclipboard data-clipboard-target="#shortLink" ngclipboard-success="vm.clipboardCopySuccess($event);" ngclipboard-error="vm.clipboardCopyError($event);">
                                                <span ng-show="vm.showClipboardTooltip">
                                                    <md-icon class="material-icons">done</md-icon>
                                                    Url Copied!
                                                </span>
                                                <span ng-show="vm.showFallbackClipboardTooltip">
                                                    <md-icon class="material-icons">done</md-icon>
                                                    Press Ctrl+C
                                                </span>
                                            </md-button>
                                        </div>
                                    </div>
                                    <md-toolbar class="md-accent md-hue-2">
                                        <div class="md-toolbar-tools">
                                            <md-icon class="material-icons" hide-xs style="margin-right:10px">trending_flat</md-icon>
                                            <h2 hide-xs hide-sm>Want to create this campaign now?</h2>
                                            <h2 hide-md hide-lg hide-xl>Create campaign now?</h2>
                                            <span flex></span>
                                            <md-button class="md-primary md-raised md-hue-2" ng-disabled="vm.showBusyText" ng-click="vm.startCampaignFromLink()" aria-label="Yes, create now!">
                                                <md-icon class="material-icons">open_in_new</md-icon>
                                                Yes<span hide-xs>, create now!</span>
                                            </md-button>
                                        </div>
                                    </md-toolbar>
                                </div>
                            </div>
                            <md-step-actions layout="row" layout-padding>
                                <div flex layout="row" layout-align="start top">
                                    <md-button ng-click="vm.moveToPreviousStep()">Go Back</md-button>
                                </div>
                                <div flex layout="row" layout-align="end top">
                                    <md-button class="md-warn" ng-click="vm.clearStepper()">
                                        Start Over
                                        <md-tooltip md-direction="left">
                                            Starting over will lose current progress.
                                        </md-tooltip>
                                    </md-button>
                                </div>
                            </md-step-actions>
                        </md-step-body>
                    </md-step>
                </md-steppers>
            </md-stepper-card-content>
        </md-card>
    </div>
</div>
